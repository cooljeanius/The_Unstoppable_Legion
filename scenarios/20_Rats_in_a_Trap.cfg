#textdomain wesnoth-The_Unstoppable_Legion
[scenario]
	id=Rats_in_a_Trap

	name= _ "Rats in a Trap"
	next_scenario=Stranger_on_the_Shore
        victory_when_enemies_defeated=no
	{UL_MAP The_Last_Stand}

	    {DAWN_HOUR}
	    {MORNING_HOUR1}
	    {MORNING_HOUR2}
	    {MORNING_HOUR3}	
	    {MORNING_HOUR4}
	    {MIDDAY_HOUR}
	    {AFTERNOON_HOUR1}
	    {AFTERNOON_HOUR2}
	    {AFTERNOON_HOUR3}
	    {AFTERNOON_HOUR4}
	    {AFTERNOON_HOUR5}
	    {AFTERNOON_HOUR6}
	    {DUSK_HOUR}
	    {FIRST_WATCH_HOUR1}
	    {FIRST_WATCH_HOUR2}
	    {FIRST_WATCH_HOUR3}
	    {FIRST_WATCH_HOUR4}
	    {MIDNIGHT_HOUR}
	    {SECOND_WATCH_HOUR1}
	    {SECOND_WATCH_HOUR2}
	    {SECOND_WATCH_HOUR3}
	    {SECOND_WATCH_HOUR4}
	    {SECOND_WATCH_HOUR5}
	    {SECOND_WATCH_HOUR6}

	{TURNS 30 30 30}

	[story]
	[switch]
		variable=allies
		[case]
			value=orcs
			[part]
			music=drums.ogg
			story= _ "Whilst the battle raged on, we headed for the mine as fast as we could. Without Prince Sven amongst us, I began to see how important he was. All this time - when Deuterus and I had chosen which paths to follow, which risks to take, which battles to fight - Sven had always been there, reassuring the dwarves that things would be all right. And now that he wasn't here I could see the morale slipping amongst them."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "Suddenly, the battle fell silent in the distance. We all felt the same sinking feel at the same time: it was all over for the orcs. The Darkguard would come after us next. And sure enough, soon we could see them on the move again. They were gaining, and if they caught up, we wouldn't have a hope in hell of surviving a fight. Our only hope was to reach the mine before this happened."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "But the valiant orcs had bought us enough time to make our escape. We had too much of a head start for the Darkguard to close the gap. By the time the last of us entered the mine, they were still a long way off. Then the dwarves pulled down the supports to the entrance, and before I knew it, they'd found the way to the exit on the other side of the mountain. We were safe - for the moment."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "And yet the bloody showdown had left me even more demoralised. Those orcs didn't stand a chance - so what hope did I have against the Darkguard? And it wasn't just the Darkguard I had to defeat, it was the whole army of Zharagorn's. Maybe, now we'd shaken off our foes, we could look for someone who might know our enemy's weakness. But who would know? And where would we look?"
			background=story/suveran.png
			[/part]
			[part]
			story= _ "Alas, there's wasn't even time for that plan. I was wrong: we hadn't shaken off the Darkguard after all. As I walked into the daylight and looked into the valley below, my heart sank. Somehow, they knew where we were headed, and this time, there was nowhere to run."
			background=story/suveran.png
			[/part]
			[part]
			    show_title=yes
				{TRAIL_TO_ALDANEN}
				{OLD_JOURNEY 264 122}
				{OLD_JOURNEY 264 101}
				{OLD_JOURNEY 270 86}
				{OLD_BATTLE 277 74}
				{OLD_JOURNEY 277 74}
				{OLD_JOURNEY 285 69}
				{OLD_BATTLE 292 65}
				{OLD_JOURNEY 292 65}
				{OLD_JOURNEY 285 69}
				{OLD_JOURNEY 277 74}
				{OLD_JOURNEY 270 86}
				{OLD_JOURNEY 264 101}
				{OLD_REST 257 127}
				{OLD_JOURNEY 288 128}
				{OLD_JOURNEY 302 121}
				{OLD_JOURNEY 314 113}
				{OLD_JOURNEY 329 106}
				{OLD_JOURNEY 346 108}
				{OLD_JOURNEY 362 122}
				{OLD_BATTLE 381 127}
				{NEW_JOURNEY 398 134}
				{NEW_BATTLE 411 144}
			background=story/suveran.png
			[/part]
		[/case]
		[case]
			value=elves 
			[part]
			music=drums.ogg
			story= _ "Aethaer-Faragan rode through the forest at breakneck speed. I follwoed behind for dear life, faster than I've ever ridden through trees before or since. I did not dare look back - but I didn't have to. No sooner had we fled the battlefield, the noise stopped, save for the cheering of Zhargorn's men. With a sinking feeling, we both knew it was all over for the other elves."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "But the valiant elves had brought us enough times to escape. As we rode out into the open, I dreaded to see my men still heading to the mountain - if they were, the Darkguard would surely catch them up - but they were already in the mine. As we rode in ourselves, we saw the explosives left by Prince Sven's dwarves, so we knew they'd made it. We blew up the entrance, and we were safe - for the moment."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "I didn't learn this until later, but whilst I was away, morale amongst my men was stretched to breaking point. Until now, I'd always assumed that if I should fall in battle, Prince Sven could take my place and lead my men to victory, but I hadn't realised how much hope they'd pinned on me personally. Either I was to lead the fight against Zharagorn, or there'd be no fight at all."
			background=story/suveran.png
			[/part]
			[part]
			story= _ "For now, however. the bloody showdown had left me even demoralised. Those elves didn't stand a chance - so what hope did I have against the Darkguard? And it wasn't just the Darkguard I had to defeat, it was the whole army of Zharagorn's. Maybe, now we'd shaken off our foes, we could look for someone who might know our enemy's weakness. But who would know? And where would we look?"
			background=story/suveran.png
			[/part]
			[part]
			story= _ "Alas, there's wasn't even time for that plan. I was wrong: we hadn't shaken off the Darkguard after all. As I walked into the daylight and looked into the valley below, my heart sank. Somehow, they knew where we were headed, and this time, there was nowhere to run."
			background=story/suveran.png
			[/part]
			[part]
			    show_title=yes
				{TRAIL_TO_ALDANEN}
				{OLD_JOURNEY 264 122}
				{OLD_JOURNEY 264 101}
				{OLD_JOURNEY 270 86}
				{OLD_BATTLE 277 74}
				{OLD_JOURNEY 277 74}
				{OLD_JOURNEY 285 69}
				{OLD_BATTLE 292 65}
				{OLD_JOURNEY 292 65}
				{OLD_JOURNEY 285 69}
				{OLD_JOURNEY 277 74}
				{OLD_JOURNEY 270 86}
				{OLD_JOURNEY 264 101}
				{OLD_REST 257 127}
				{OLD_JOURNEY 288 128}
				{OLD_JOURNEY 302 121}
				{OLD_JOURNEY 314 113}
				{OLD_JOURNEY 329 106}
				{OLD_JOURNEY 346 108}
				{OLD_JOURNEY 362 122}
				{OLD_BATTLE 381 127}
				{NEW_JOURNEY 398 134}
				{NEW_BATTLE 411 144}
			background=story/suveran.png
			[/part]
		[/case]
	[/switch]
	[/story]

# Viktor's Forces

[side]
	side=1
	controller=human
	team_name=Viktor

	type=Mounted Noble
	id=Viktor
	unrenamable=yes
	canrecruit=yes

# Gold carried over from previous scenario.

	{GOLD 0 0 0}
	{INCOME 2 1 0}
	
[/side]

# New Thorben garrison

[side]
	side=2
	controller=ai
	team_name=Zharagorn

	type=Dark Warrior
	id=Jaan Gragath
	name= _ "Jaan Gragath"
	unrenamable=yes
	canrecruit=yes
	recruit=Spearman,Heavy Infantryman,Bowman,Mage

	[ai]
		recruitment_pattern=fighter,fighter,archer,mixed fighter
		protect_leader=4.0
		protect_leader_radius=10
		village_value=1
		villages_per_scout=0	
		grouping=offensive
		passive_leader_shares_keep=yes

# Keep forces within town
		[avoid]
			x=1-14,15-19,15-16,17-18,20-26,19-21,22-27,27-28,28-29,  29,30-31,30-31,32-48
			y=1-36,1-15, 22-36,25-36, 1-14,27-36,26-36, 1-15,25-36,1-16,24-36, 1-18, 1-36
		[/avoid]
	[/ai]

	{GOLD 75 75 75}
	{INCOME 0 1 2}

[/side]

# Zharagorn's orc allies

[side]
	side=3
	controller=ai
	team_name=Zharagorn

	no_leader=yes
	unrenamable=yes
	canrecruit=yes

	recruit=Goblin Spearman
	[ai]

		recruitment_pattern=scout,archer,fighter,fighter

	[/ai]

	{GOLD 40 50 60}
	{INCOME 6 9 12}	
[/side]

# Zharagorn's main force (set to side 4 because Dark Riders refuse to belong to any other side for some reason).

[side]
	side=4
	controller=ai
	team_name=Zharagorn

	no_leader=yes
	unrenamable=yes
	canrecruit=yes
	recruit=Dark Cultist

	[ai]
		recruitment_pattern=fighter,fighter,scout,archer
	[/ai]

	{GOLD 40 50 60}
	{INCOME 12 16 20}

[/side]

#Zharagorn's undead allies

[side]
	side=5
	controller=ai
	team_name=Zharagorn

	no_leader=yes
	canrecruit=yes
	recruit=Vampire Bat,Walking Corpse

	[ai]
		recruitment_pattern=fighter,fighter,fighter,scout,archer
	[/ai]

	{GOLD 40 50 60}
	{INCOME 6 9 12}

[/side]

# Side to be used for village idiot

[side]
	side=6
	controller=ai
	team_name=Viktor

	no_leader=yes
	canrecruit=no

	{GOLD 0 0 0}
	{INCOME 0 0 0}

	# Set AI so that he never attacks except when there is no relatiation.

	[ai]
		aggression=-1000
	[/ai]

[/side]

[event]
	name=prestart

# Change starting position to mountains.

	[terrain]
		x=32
		y=4
		terrain=Mm
	[/terrain]
	[item]
		x=32
		y=4
		image=scenery/mine-abandoned.png
	[/item]
	[terrain]
		x=31-33
		y=5-6
		terrain=Ce
	[/terrain]
	[terrain]
		x=32
		y=5
		terrain=Ke
	[/terrain]

#Remove any surviving orcs/elves from the recall list.

	[kill]
		race=orc
		side=1
	[/kill]
	[kill]
		race=elves
		side=1
	[/kill]
	{TELEPORT_UNIT id=Dummy 32 6}
	[switch]
		variable=allies
		[case]
			value=orcs
			{TELEPORT_UNIT id=Viktor 32 5}
		[/case]
		[case]
			value=elves
			{TELEPORT_UNIT id=Viktor 32 6}
			[recall]
				id=Prince Sven
				x,y=32,5
			[/recall]
# Have to call this variable something other than viktor because another routine interferes with this variable.

			[store_unit]
				[filter]
				id=Viktor
				[/filter]
				variable=viktor_start
				kill=yes
			[/store_unit]
		[/case]
	[/switch]
				
	[recall]
		id=Hubert
	[/recall]
	[recall]
		id=Golran
	[/recall]
	[recall]
	    side=1
	    [filter_wml]
		[modifications]
		    [object]
		        id=holywater
		    [/object]
		[/modifications]
	    [/filter_wml]
	[/recall]
	[recall]
		id=Halgar the Mighty
	[/recall]
	[recall]
		id=Captain Josephine
	[/recall]
	[switch]
		variable=allies
		[case]
			value=orcs
			[role]
				type=Dwarvish Dragonguard,Dwarvish Lord,Dwarvish Sentinel,Dwarvish Thunderguard,Dwarvish Steelclad,Dwarvish Stalwart,Dwarvish Thunderer,Dwarvish Fighter,Dwarvish Guardsman
				x,y=recall,recall
				role=dwarf_advisor
			[/role]
			[recall]
				role=dwarf_advisor
			[/recall]
		[/case]
		[case]
			value=elves
			[role]
				type=Elite Bowknight,Coutillier,Paladin,Cavalier,Grand Knight,Bowknight,Dragoon,Cataphract,Knight,Lancer,Holibar,Bowrider,UL_Cavalryman,UL_Horseman
				x,y=recall,recall
				role=human_advisor
			[/role]
			[recall]
				role=human_advisor
			[/recall]
		[/case]
	[/switch]

#Deploy guards for side 2

#define RT_SPEARMAN X Y
	[unit]
		type=Spearman
		generate_name=yes
		x={X}
		y={Y}
		side=2
		ai_special=guardian
		[modifications]
			{TRAIT_LOYAL}
			{TRAIT_RESILIENT}
		[/modifications]
	[/unit]
#enddef
#define RT_FIGHTER X Y
	[unit]
		type=Dark Fighter
		generate_name=yes
		x={X}
		y={Y}
		side=2
		ai_special=guardian
		[modifications]
			{TRAIT_LOYAL}
			{TRAIT_RESILIENT}
		[/modifications]
	[/unit]
#enddef

	{RT_SPEARMAN 23 15}
	{RT_FIGHTER 25 15}
	{RT_SPEARMAN 28 16}
	{RT_FIGHTER 31 19}
	{RT_SPEARMAN 31 22}
	{RT_FIGHTER 28 24}
	{RT_SPEARMAN 26 25}
	{RT_FIGHTER 19 26}
	{RT_SPEARMAN 17 24}
	{RT_FIGHTER 15 21}
	{RT_SPEARMAN 15 17}
	{RT_FIGHTER 20 15}

# Restore gold. (Yes, this WML is a mess. Cleaning this up is on my to-do list.)

	[store_gold]
		side=1
	[/store_gold]
	[set_variable]
		name=gold
		multiply=-1
	[/set_variable]
	[gold]
		side=1
		amount=$gold
	[/gold]
	{VARIABLE_OP main_gold multiply -1}
	[gold]
		side=1
		amount=$main_gold
	[/gold]

#Remove orcs/elves from recruit list

	[set_recruit]
		side=1
		recruit=UL_Dwarvish Fighter,UL_Dwarvish Thunderer,Dwarvish Guardsman
	[/set_recruit]
	[allow_extra_recruit]
		id=Viktor
		extra_recruit=UL_Cavalryman,UL_Horseman,Bowrider
	[/allow_extra_recruit]

# On elves path, Prince Sven can recall any unit for the first two turns. (Don't need a condition here, because on the orcs path he's not here at all for the first two turns.)
	[allow_extra_recruit]
		id=Prince Sven
		extra_recruit=UL_Cavalryman,UL_Horseman,Bowrider
	[/allow_extra_recruit]

	[terrain]
		x=38
		y=34
		terrain=Gg
	[/terrain]

	[terrain]
		x=3
		y=20
		terrain=Gg
	[/terrain]

	[terrain]
		x=47
		y=16
		terrain=Gg
	[/terrain]

# Calculate when reinforcements arrive. (The longer you held out in previous scenario, the later this will be.)

	[set_variable]
		name=reinforcements1
		value=$turns_held
	[/set_variable]
	[set_variable]
		name=reinforcements1
		divide=2
	[/set_variable]
	[set_variable]
		name=reinforcements1
		round=floor
	[/set_variable]
	[set_variable]
		name=reinforcements2
		value=$reinforcements1
	[/set_variable]
	[set_variable]
		name=reinforcements3
		value=$reinforcements1
	[/set_variable]
	[set_variable]
		name=reinforcements1
		sub=2
	[/set_variable]
	[set_variable]
		name=reinforcements3
		add=2
	[/set_variable]

	[set_variable]
		name=reinforcements4
		value=$turns_held
	[/set_variable]
	[set_variable]
		name=reinforcements4
		sub=4
	[/set_variable]
	[set_variable]
		name=reinforcements5
		value=$turns_held
	[/set_variable]
	[set_variable]
		name=reinforcements5
		sub=2
	[/set_variable]
	[set_variable]
		name=reinforcements6
		value=$turns_held
	[/set_variable]
[/event]

# Side 2 starts with villages near keep

	{STARTING_VILLAGES 2 8}

[event]
	name=start

	[music]
		name=frantic.ogg
		immediate=yes
	[/music]
	[switch]
		variable=allies
		[case]
		value=orcs
		
		[message]
			speaker=Viktor
			message = _ "We've made it! I see Thorben in the valley."
		[/message]
		[message]
			speaker=Hubert
			message = _ "Yes, thanks to those orcs. At least they didn't die in vain."
		[/message]
		[message]
			speaker=Golran
			message = _ "I just hope Prince Sven's all right. We need him back leading us dwarves."
		[/message]
		[message]
			role=dwarf_advisor
			message = _ "I wouldn't relax just yet. Looks like Zharagorn's men have re-garrisoned the town since our last visit."
		[/message]
		[message]
			speaker=Jaan Gragath
			message = _ "So, you have returned! I hoped you would. You can join your friend Deuterus in the next world."
		[/message]
		[message]
		    side=1
		    [filter_wml]
			[modifications]
			    [object]
				id=holywater
			    [/object]
			[/modifications]
		    [/filter_wml]
			message= _ "I don't believe it! The survivors of Thorben's guard are fighting under a commander of Zharagorn."
		[/message]
		[message]
			speaker=Halgar the Mighty
			message = _ "So, the survivors of Thorben's guard are still fighting for Zhargorn. Let's teach them a lesson."
		[/message]
		[message]
			speaker=Captain Josephine
			message = _ "Look Viktor! The survivors of Thorben's guard are still teamed up up with Zharagorn. That's crazy."
		[/message]
		[message]
			speaker=Viktor
			message = _ "Damn! I wanted us out of here. The longer we stay here, the more likely the Darkguard will catch us up."
		[/message]
		[message]
			role=dwarf_advisor
			message = _ "Well, we can't go until Prince Sven arrives. He won't know where to go if we're not here."
		[/message] 
		[message]
			role=Viktor
			message = _ "Yes, that settles it. No choice, we'll have to fight. To arms!"
		[/message] 
		[objectives]
			side=1
			victory_string= _ "Objective I:"
				[objective]
					description= _ "Fight enemies until further notice."
					condition=win
				[/objective]
				[objective]
					description= _ "Death of Viktor"
					condition=lose
				[/objective]
		[/objectives]
		[/case]
		[case]
		value=elves
		
		[message]
			speaker=Prince Sven
			message = _ "We've made it! I see Thorben in the valley."
		[/message]
		[message]
			speaker=Hubert
			message = _ "Yes, thanks to those elves. At least they didn't die in vain."
		[/message]
		[message]
			speaker=Golran
			message = _ "I just hope Viktor's all right. If he'd lost, we're all lost."
		[/message]
		[message]
			role=human_advisor
			message = _ "I wouldn't relax just yet. Looks like Zharagorn's men have re-garrisoned the town since our last visit."
		[/message]
		[message]
			speaker=Jaan Gragath
			message = _ "So, you have returned! I hoped you would. You can join your friend Deuterus in the next world."
		[/message]
		[message]
		    side=1
		    [filter_wml]
			[modifications]
			    [object]
				id=holywater
			    [/object]
			[/modifications]
		    [/filter_wml]
			message= _ "I don't believe it! The survivors of Thorben's guard are fighting under a commander of Zharagorn."
		[/message]
		[message]
			speaker=Halgar the Mighty
			message = _ "So, the survivors of Thorben's guard are still fighting for Zhargorn. Let's teach them a lesson."
		[/message]
		[message]
			speaker=Captain Josephine
			message = _ "Look Viktor! The survivors of Thorben's guard are still teamed up up with Zharagorn. That's crazy."
		[/message]
		[message]
			speaker=Prince Sven
			message = _ "Curse them! I wanted us out of here. The longer we stay, the more likely the Darkguard will catch us up."
		[/message]
		[message]
			role=human_advisor
			message = _ "Well, we can't go until Viktor arrives. He won't know where to go if we're not here."
		[/message] 
		[message]
			role=Prince Sven
			message = _ "You're right, there's not much choice. That settles it. To arms!"
		[/message] 
		[objectives]
			side=1
			victory_string= _ "Objective I:"
				[objective]
					description= _ "Fight enemies until further notice."
					condition=win
				[/objective]
				[objective]
					description= _ "Death of Prince Sven"
					condition=lose
				[/objective]
			note = _ "Until Viktor returns, Prince Sven can recruit and recall any unit"
		[/objectives]
		[/case]
	[/switch]

[/event]

# Prince Sven can only recall other dwarves (except for first two turns)

[event]
	name=recall
	first_time_only=no
	[filter]
		[not]
		race=dwarf
		[/not]
	[/filter]
	[filter_second]
		id=Prince Sven
	[/filter_second]

	[if]
		[variable]
			name=turn_number
			greater_than=2
		[/variable]
		[then]
			[message]
				speaker=narrator
				message= _ "Prince Sven can only recall other dwarves."
			[/message]
			[modify_unit]
				[filter]
					x,y=$x1,$y1
				[/filter]
				x=recall
				y=recall
			[/modify_unit]

		# Refund the 20 gold recall cost.

			[gold]
				side=1
				amount=20
			[/gold]
		[/then]
	[/if]	
[/event]

# Change recruits for side 2 to give a mixture of dark fighters and loyalists

[event]

	name=new turn
	first_time_only=no

	{RANDOM 1..2}

		[if]
			[variable]
			name=random
			numerical_equals=1
			[/variable]
			[then]
			[allow_recruit]
				side=2
				type=Dark Fighter,Dark Cultist,Dark Adept
			[/allow_recruit]
			[disallow_recruit]
				side=2
				type=Spearman,Heavy Infantryman,Bowman,Mage
			[/disallow_recruit]
			[/then]
			[else]
			[allow_recruit]
				side=2
				type=Spearman,Heavy Infantryman,Bowman,Mage
			[/allow_recruit]
			[disallow_recruit]
				side=2
				type=Dark Fighter,Dark Cultist,Dark Adept
			[/disallow_recruit]
			[/else]
		[/if]

[/event]


[event]
	name=turn 3

	[disallow_extra_recruit]
		id=Prince Sven
		extra_recruit=UL_Cavalryman,UL_Horseman,Bowrider
	[/disallow_extra_recruit]

	[switch]
		variable=allies
		[case]
		value=orcs
		
		[scroll_to]
			x=32
			y=4
		[/scroll_to]		
		[sound]
			name=magic-dark-big.ogg
		[/sound]
		[unstore_unit]
			variable=sven
			x=32
			y=4
			find_vacant=yes
		[/unstore_unit]
		[unstore_unit]
			variable=argrath
			x=31
			y=4
			find_vacant=yes
		[/unstore_unit]
		[heal_unit]
			[filter]
				id=Prince Sven
			[/filter]
			animate=no
			amount=full
			moves=full
		[/heal_unit]
		[heal_unit]
			[filter]
				id=Mur'ag-Argrath
			[/filter]
			animate=no
			amount=full
			moves=full
		[/heal_unit]
		# Mur'ag-Argrath is no longer a hero

			{MODIFY_UNIT (id=Mur'ag-Argrath) overlays "loyal-icon.png"}
		[redraw]
		[/redraw]
		[message]
			speaker=Viktor
			message = _ "Prince Sven! Thank goodness you're all right."
		[/message]
		[message]
			speaker=Prince Sven
			message = _ "I am. I'm afraid it's not so good for the orcs."
		[/message]
		[message]
			speaker=Mur'ag-Argrath
			message = _ "Sorry it took so long to get here. It took several teleports before we reached the right place."
		[/message]
		[message]
			speaker=Viktor
			message = _ "Right, now we're all accounted for, let's get out of here."
		[/message]
		[message]
			role=dwarf_advisor
			message = _ "Oh no ... this is bad."
		[/message]

		[/case]
		[case]
		value=elves
		
		[scroll_to]
			x=32
			y=4
		[/scroll_to]		
		[sound]
			name=horse-canter.ogg
		[/sound]

		[unstore_unit]
			variable=viktor_start
			x=32
			y=4
			find_vacant=yes
		[/unstore_unit]
		[unstore_unit]
			variable=aethaer
			x=31
			y=4
			find_vacant=yes
		[/unstore_unit]
		[heal_unit]
			[filter]
				id=Viktor
			[/filter]
			animate=no
			amount=full
			moves=full
		[/heal_unit]
		[heal_unit]
			[filter]
				id=Aethaer-Faragan
			[/filter]
			animate=no
			amount=full
			moves=full
		[/heal_unit]
		# Aethaer-Faragan is no longer a hero

			{MODIFY_UNIT (id=Aethaer-Faragan) overlays "loyal-icon.png"}
		[redraw]
		[/redraw]
		[message]
			speaker=Prince Sven
			message = _ "Viktor! You have no idea how glad we are to see you!"
		[/message]
		[message]
			speaker=Viktor
			message = _ "Indeed. I'm afraid the news from the elves is much different."
		[/message]
		[message]
			speaker=Aethaer-Faragan
			message = _ "Sorry it took so long to get here. Neither of us know how to fins our way through mines."
		[/message]
		[message]
			speaker=Viktor
			message = _ "Right, now we're all accounted for, let's get out of here."
		[/message]
		[message]
			role=human_advisor
			message = _ "Oh no ... this is bad."
		[/message]

		[/case]
	[/switch]
	[music]
		name=battle.ogg
		immediate=yes
	[/music]
	[music]
		name=casualties_of_war.ogg
		ms_before=500
		append=yes
	[/music]
	[music]
		name=battle-epic.ogg
		ms_before=500
		append=yes
	[/music]
	[music]
		name=heroes_rite.ogg
		ms_before=500
		append=yes
	[/music]
	[terrain]
		x=2-4
		y=19-20
		terrain=Ce
	[/terrain]
	[terrain]
		x=3
		y=21
		terrain=Ce
	[/terrain]
	[terrain]
		x=3
		y=20
		terrain=Ke
	[/terrain]
	[redraw]
	[/redraw]
	    [unit]
		id=Greech
		name= _ "Greech"
		type=Goblin Rouser
		side=3
		x=3
		y=20
		random_traits=no
		canrecruit=yes
	    [/unit]
	{GENERIC_UNIT 3 (Goblin Spearman) 3 19}
	{GENERIC_UNIT 3 (Goblin Spearman) 4 19}
	{GENERIC_UNIT 3 (Goblin Spearman) 4 20}
	{GENERIC_UNIT 3 (Goblin Spearman) 3 21}
	{GENERIC_UNIT 3 (Goblin Spearman) 2 20}
	{GENERIC_UNIT 3 (Goblin Spearman) 2 19}
	[message]
		speaker=Greech
		message = _ "Hah! Found them!"
	[/message]
	
	[terrain]
		x=20
		y=34
		terrain=Ce
	[/terrain]
	[terrain]
		x=19-21
		y=35-36
		terrain=Ce
	[/terrain]
	[terrain]
		x=20
		y=35
		terrain=Ke
	[/terrain]
	[redraw]
	[/redraw]
	    [unit]
		id=Marg-Astora
		name= _ "Marg-Astora"
		type=Dark Headhunter
		side=4
		x=20
		y=35
		random_traits=no
		canrecruit=yes
	    [/unit]
	{GENERIC_UNIT 4 (Dark Cultist) 20 34}
	{GENERIC_UNIT 4 (Dark Fighter) 21 35}
	{GENERIC_UNIT 4 (Dark Cultist) 21 36}
	{GENERIC_UNIT 4 (Dark Fighter) 20 36}
	{GENERIC_UNIT 4 (Dark Cultist) 19 36}
	{GENERIC_UNIT 4 (Dark Fighter) 19 35}
	[message]
		speaker=Marg-Astora
		message = _ "So you thought you could run from us, did you?"
	[/message]
	[terrain]
		x=46-48
		y=15-16
		terrain=Ce
	[/terrain]
	[terrain]
		x=47
		y=17
		terrain=Ce
	[/terrain]
	[terrain]
		x=47
		y=16
		terrain=Ke
	[/terrain]
	[redraw]
	[/redraw]
	    [unit]
		id=Mauhl-Mauhgan
		name= _ "Mauhl-Mauhgan"
		type=Soulless
		side=5
		x=47
		y=16
		random_traits=no
		canrecruit=yes
	    [/unit]
	{GENERIC_UNIT 5 (Walking Corpse) 47 15}
	{GENERIC_UNIT 5 (Vampire Bat) 48 15}
	{GENERIC_UNIT 5 (Walking Corpse) 48 16}
	{GENERIC_UNIT 5 (Vampire Bat) 47 17}
	{GENERIC_UNIT 5 (Walking Corpse) 46 16}
	{GENERIC_UNIT 5 (Vampire Bat) 46 15}
	[message]
		speaker=Mauhl-Mauhgan
		message = _ "Ragghhh-hahh-hahhh!"
	[/message]

	[message]
		speaker=Prince Sven
		message = _ "Curse them! How did they know were were headed this way?"
	[/message]
	[message]
		speaker=Viktor
		message = _ "Perhaps we can make a break for it. Those forces south look weak."
	[/message] 
	[message]
		role=dwarf_advisor
		message = _ "No, that's just a first wave. I can see more forces coming in from all three directions."
	[/message] 
	[message]
		role=human_advisor
		message = _ "No, that's just a first wave. I can see more forces coming in from all three directions."
	[/message] 
	[message]
		speaker=Viktor
		message = _ "Okay then. I think we'd better take out the enemy in Thorben, shore up our defences, and take things from there."
	[/message] 
	[objectives]
		side=1
		victory_string= _ "Objective II:"
			[objective]
				description= _ "Fight enemies until further notice."
				red=127
				green=127
				blue=127
				condition=win
			[/objective]
			[objective]
				description= _ "Defeat the enemy leader in Thorben"
				condition=win
			[/objective]
			[objective]
				description= _ "Death of Viktor"
				condition=lose
			[/objective]
			[objective]
				description= _ "Death of Prince Sven"
				condition=lose
			[/objective]
            {TURNS_RUN_OUT}
	[/objectives]

[/event]

[event]
	name=last_breath
	[filter]
		id=Jaan Gragath
	[/filter]
	[message]
		speaker=Jaan Gragath
		message= _ "What are you waiting for? Go on, kill me."
	[/message]
	[message]
		speaker=Viktor
		message= _ "I'm giving you one chance only. What have you done with Deuterus's body?"
	[/message]
	[message]
		speaker=Jaan Gragath
		message= _ "I would rather die than tell you anything."
	[/message]
	[message]
		speaker=second_unit
		message= _ "Very well, have it your way."
	[/message]
[/event]

[event]
	name=die
	[filter]
		id=Jaan Gragath
	[/filter]
	[unit]
		type=Peasant
		id=Village idiot
		name= _ "Village idiot"
		x=24
		y=18
		side=6
	[/unit]
	{MOVE_UNIT (id=Village idiot) 25 17}
	{MODIFY_UNIT (id=Village idiot) facing se}
	[message]
		speaker=Village idiot
		message= _ "Hah! You showed that hoodlum's who's boss!"
	[/message]
	[message]
		speaker=Prince Sven
		message= _ "(Who's he?)"
	[/message]
	[message]
		speaker=Village idiot
		message= _ "I knew he was a bad 'un. He had it coming!"
	[/message]
	[message]
		speaker=Viktor
		message= _ "Erm, I'm Viktor, pleased to meet you. Who are you?"
	[/message]
	[message]
		speaker=Village idiot
		message= _ "You looking for that druid? Burned, he was! All burned!"
	[/message]
	[message]
		speaker=Viktor
		message= _ "Okay, er, well, you'd better take cover before-"
	[/message]
	[message]
		speaker=Village idiot
		message= _ "Right, find me some varmints! Let me at 'em!"
	[/message]
	[message]
		speaker=Prince Sven
		message= _ "Never mind him, what are we going to do about the rest of the forces?"
	[/message]
	[message]
		speaker=Viktor
		message= _ "I don't know. Stand our ground and hope for the best, I guess."
	[/message]
	[objectives]
		side=1
			[objective]
				description= _ "Fight enemies until further notice."
				red=127
				green=127
				blue=127
				condition=win
			[/objective]
			[objective]
				description= _ "Defeat the enemy leader in Thorben"
				red=127
				green=127
				blue=127
				condition=win
			[/objective]
			[objective]
				description= _ "Hold out until turns end"
				condition=win
			[/objective]
			[objective]
				description= _ "Death of Viktor"
				condition=lose
			[/objective]
			[objective]
				description= _ "Death of Prince Sven"
				condition=lose
			[/objective]
			    [gold_carryover]
				bonus=no
				carryover_percentage=40
			    [/gold_carryover]
	[/objectives]

# Gold bonus the turn after leader defeated

	[event]
		name=new turn

		[message]
			speaker=Prince Sven
			message= _ "Now we've cleared the keep, let's see what we can find in their armoury."
		[/message]
		[sound]
			name=gold.ogg
		[/sound]

		#ifdef EASY
			[message]
				speaker=narrator
				message= _ "You gain 120 pieces of gold."
			[/message]
			[gold]
				side=1
				amount=120
			[/gold]
		#endif
		#ifdef NORMAL
			[message]
				speaker=narrator
				message= _ "You gain 100 pieces of gold."
			[/message]
			[gold]
				side=1
				amount=100
			[/gold]
		#endif
			#ifdef HARD
			[message]
				speaker=narrator
				message= _ "You gain 80 pieces of gold."
			[/message]
			[gold]
				side=1
				amount=80
			[/gold]
		#endif

		[message]
			speaker=Viktor
			message= _ "There's not much left. But we need every fighting hand we can get."
		[/message]	
	[/event]

[/event]

# Set village idiot to follow Viktor

[event]
	name=side turn
	first_time_only=no
	[store_unit]
		[filter]
			id=Viktor
		[/filter]
		variable=viktor
	[/store_unit]

	{MODIFY_UNIT (id=Village idiot) goto_x $viktor.x}
	{MODIFY_UNIT (id=Village idiot) goto_y $viktor.y}
[/event]

[event]
	name=attack
	[filter_second]
		id=Village idiot
	[/filter_second]

	[message]
		speaker=Viktor
		message= _ "Please, leave that man alone. Your fight is with me."
	[/message]
	[message]
		speaker=Village idiot
		message= _ "Hey, you! Don't tell me who I can't fight! I'll have the lot of you!"
	[/message]
	[message]
		speaker=Viktor
		message= _ "Oh no ..."
	[/message]
	[message]
	    side=4
	    [filter_wml]
	    canrecruit=yes
	    [/filter_wml]
		message= _ "Wait - leave him for now. He's up to something, and I want to know what."
	[/message]
	[message]
		speaker=Village idiot
		message= _ "Hah! I knew you were too scared!"
	[/message]
	[message]
	    side=4
	    [filter_wml]
	    canrecruit=yes
	    [/filter_wml]
		message= _ "On second thoughts, he's getting on my nerves. Kill him."
	[/message]
	[message]
		speaker=Hubert
		message= _ "I don't think I can watch this ..."
	[/message]

[/event]

# Events for death tags of village idiot are nested, so he can reappear and disappear up to three times.

[event]
	name=last_breath
	[filter]
		id=Village idiot
	[/filter]

	[kill]
		id=Village idiot
		animate=no
	[/kill]

	[message]
		speaker=Viktor
		message= _ "Hey, where did he go?"
	[/message]
	[message]
		speaker=second_unit
		message= _ "???"
	[/message]
	[message]
	    side=4
	    [filter_wml]
		[modifications]
		    canrecruit=yes
		[/modifications]
	    [/filter_wml]
		message= _ "Never mind him! Hurry up and kill the rest!"
	[/message]
	[event]
		name=last_breath
		[filter]
			id=Village idiot
		[/filter]

		[kill]
			id=Village idiot
			animate=no
		[/kill]

		[message]
			speaker=Viktor
			message= _ "He's done it again! He's just vanished!"
		[/message]
		[message]
			speaker=second_unit
			message= _ "???"
		[/message]
		[message]
		    side=4
		    [filter_wml]
			[modifications]
			    canrecruit=yes
			[/modifications]
		    [/filter_wml]
			message= _ "Right, I don't care who he is! Find him and kill him!"
		[/message]

	[/event]

[/event]

#define ENEMY_GOLD SIDE

#ifdef EASY
	[gold]
		side={SIDE}
		amount=40
	[/gold]
#endif
#ifdef NORMAL
	[gold]
		side={SIDE}
		amount=50
	[/gold]
#endif
	#ifdef HARD
	[gold]
		side={SIDE}
		amount=60
	[/gold]
#endif

#enddef

# Reinforcements will arrive ai specified turns, depending on how long play held out in the previous scenario. Doing this as new turn event, because turn X doesn't seem to like variables.

[event]
	name=new turn
	first_time_only=no
	[switch]
		variable=turn_number
		[case]
			value=$reinforcements1
			[message]
				speaker=Marg-Astora
				message= _ "We have them, Master! Rats in a trap!"
			[/message]
			[message]
				speaker=Prince Sven
				message= _ "'Master?' Who's he speaking to?"
			[/message]
			[message]
				speaker=Viktor
				message= _ "Oh dear, I don't like the sound of this."
			[/message]

			{MOVE_UNIT (id=Marg-Astora) 20 33}
			{MODIFY_UNIT (id=Marg-Astora) canrecruit no}
			    [unit]
				id=Mal-Ockerun
				name= _ "Mal-Ockerun"
				type=Dark Marauder
				side=4
				x=20
				y=35
				random_traits=no
				canrecruit=yes
			    [/unit]
			{GENERIC_UNIT 4 (Dark Headhunter) 20 34}
			{GENERIC_UNIT 4 (Dark Warrior) 21 35}
			{GENERIC_UNIT 4 (Dark Headhunter) 21 36}
			{GENERIC_UNIT 4 (Dark Warrior) 20 36}
			{GENERIC_UNIT 4 (Dark Headhunter) 19 36}
			{GENERIC_UNIT 4 (Dark Warrior) 19 35}

			{ENEMY_GOLD 4}

			[message]
				speaker=Mal-Ockerun
				message = _ "Excellent. My men had you surrounded before you could escape. Now more and more of us will come until you perish."
			[/message]

			[allow_recruit]
				side=4
				type=Dark Fighter,Dark Headhunter,Dark Adept
			[/allow_recruit]

			[message]
				speaker=Prince Sven
				message= _ "Got any bright ideas?"
			[/message]
			[message]
				speaker=Viktor
				message= _ "Not really. All we can do is carry on fighting and hope for the best."
			[/message]
			[if]
				[have_unit]
				id=Village idiot
				[/have_unit]
				[then]
					[message]
						speaker=Village idiot
						message= _ "Pah! Bring 'em on! I'll have 'em all!"
					[/message]
					[message]
						speaker=Viktor
						message= _ "Oh well, at least we've one optimist."
					[/message]
				[/then]
				[else]
					[unit]
						type=Peasant
						id=Village idiot
						name= _ "Village idiot"
						x=24
						y=18
						side=6
					[/unit]
					{MOVE_UNIT (id=Village idiot) 25 17}
					{MODIFY_UNIT (id=Village idiot) facing se}
					[message]
						speaker=Village idiot
						message= _ "Pah! Bring 'em on! I'll have 'em all!"
					[/message]
					[message]
						speaker=Viktor
						message= _ "Huh? It's him again. Where's he been hiding?"
					[/message]
				[/else]
			[/if]		
		[/case]
		[case]
			value=$reinforcements2
			{MOVE_UNIT (id=Greech) 5 19}
			{MODIFY_UNIT (id=Greech) canrecruit no}
			    [unit]
				id=Kurug-Graug
				name= _ "Kurug-Graug"
				type=Orcish Warrior
				side=3
				x=3
				y=20
				random_traits=no
				canrecruit=yes
			    [/unit]
			{GENERIC_UNIT 3 (Orcish Grunt) 3 19}
			{GENERIC_UNIT 3 (Wolf Rider) 4 19}
			{GENERIC_UNIT 3 (Troll Whelp) 4 20}
			{GENERIC_UNIT 3 (Orcish Grunt) 3 21}
			{GENERIC_UNIT 3 (Orcish Archer) 2 20}
			{GENERIC_UNIT 3 (Troll Whelp) 2 19}

			[message]
				speaker=Kurug-Graug
				message = _ "Die! Die! Die!"
			[/message]
			[allow_recruit]
				side=3
				type=Orcish Grunt,Orcish Archer,Troll Whelp,Wolf Rider
			[/allow_recruit]
			{ENEMY_GOLD 3}
		[/case]
		[case]
			value=$reinforcements3
			{MOVE_UNIT (id=Mauhl-Mauhgan) 45 15}
			{MODIFY_UNIT (id=Mauhl-Mauhgan) canrecruit no}
			    [unit]
				id=Mauhl-Mergren
				name= _ "Mauhl-Mergren"
				type=Revenant
				side=5
				x=47
				y=16
				random_traits=no
				canrecruit=yes
			    [/unit]

			{GENERIC_UNIT 5 (Soulless) 47 15}
			{GENERIC_UNIT 5 (Ghost) 48 15}
			{GENERIC_UNIT 5 (Skeleton) 48 16}
			{GENERIC_UNIT 5 (Ghost) 47 17}
			{GENERIC_UNIT 5 (Soulless) 46 16}
			{GENERIC_UNIT 5 (Skeleton Archer) 46 15}

			[message]
				speaker=Mauhl-Mergren
				message = _ "Ragghhh-hahh-hahhh!"
			[/message]
			[allow_recruit]
				side=5
				type=Ghost,Skeleton,Skeleton Archer
			[/allow_recruit]

			{ENEMY_GOLD 5}
		[/case]
		[case]
			value=$reinforcements4
			[message]
				speaker=Mal-Ockerun
				message= _ "So you think you can hold us off? The worst is yet to come."
			[/message]
			[message]
				speaker=Prince Sven
				message= _ "This is bad. This is really really bad."
			[/message]

			{MOVE_UNIT (id=Mal-Ockerun) 20 33}
			{MODIFY_UNIT (id=Mal-Ockerun) canrecruit no}
			    [unit]
				type=Dark Champion
				id=Grand General Saathan
				name= _ "Grand General Saathan"
				unrenamable=yes
				side=4
				x=20
				y=35
				random_traits=no
				canrecruit=yes
			    [/unit]
			{GENERIC_UNIT 4 (Dark Marauder) 20 34}
			{GENERIC_UNIT 4 (Dark Warrior) 21 35}
			{GENERIC_UNIT 4 (Dark Sorcerer) 21 36}
			{GENERIC_UNIT 4 (Dark Warrior) 20 36}
			{GENERIC_UNIT 4 (Dark Marauder) 19 36}
			{GENERIC_UNIT 4 (Dark Warrior) 19 35}

			[message]
				speaker=Grand General Saathan
				message = _ "No-one escapes the Darkguard. When Zharagorn commands your death, we see you die in agony."
			[/message]

			[allow_recruit]
				side=4
				type=Dark Warrior,Dark Marauder,Dark Sorcerer
			[/allow_recruit]

			{ENEMY_GOLD 4}

			[message]
				speaker=Prince Sven
				message= _ "You know Viktor, this time I don't see a way out of it."
			[/message]
			[message]
				speaker=Viktor
				message= _ "Me neither, I'm afraid. But at least we'll go down fighting."
			[/message]
			[if]
				[have_unit]
				id=Village idiot
				[/have_unit]
				[then]
					[message]
						speaker=Village idiot
						message= _ "Not if I can help it!"
					[/message]
					[message]
						speaker=Viktor
						message= _ "Someone's still an optimist."
					[/message]
				[/then]
				[else]
					[unit]
						type=Peasant
						id=Village idiot
						name= _ "Village idiot"
						x=24
						y=18
						side=6
					[/unit]
					{MOVE_UNIT (id=Village idiot) 25 17}
					{MODIFY_UNIT (id=Village idiot) facing se}
					[message]
						speaker=Village idiot
						message= _ "Not if I can help it!"
					[/message]
					[message]
						speaker=Viktor
						message= _ "How does he do that?"
					[/message]
				[/else]
			[/if]		
		[/case]
		[case]
			value=$reinforcements5
			{MOVE_UNIT (id=Kurug-Graug) 5 19}
			{MODIFY_UNIT (id=Kurug-Graug) canrecruit no}
			    [unit]
				type=Orcish Warlord
				id=Nur'ag-Garg
				name= _ "Nur'ag-Garg"
				unrenamable=yes
				side=3
				x=3
				y=20
				random_traits=no
				canrecruit=yes
			    [/unit]
			{GENERIC_UNIT 3 (Orcish Warrior) 3 19}
			{GENERIC_UNIT 3 (Wolf Rider) 4 19}
			{GENERIC_UNIT 3 (Troll) 4 20}
			{GENERIC_UNIT 3 (Orcish Grunt) 3 21}
			{GENERIC_UNIT 3 (Orcish Crossbowman) 2 20}
			{GENERIC_UNIT 3 (Troll Whelp) 2 19}

			[message]
				speaker=Nur'ag-Garg
				message = _ "At last! I knew you wouldn't get away."
			[/message]
			{ENEMY_GOLD 3}
			[allow_recruit]
				side=3
				type=Orcish Warrior,Orcish Crossbowman,Troll,Wolf Rider
			[/allow_recruit]
		[/case]
		[case]
			value=$reinforcements6
			{MOVE_UNIT (id=Mauhl-Mergren) 45 15}
			{MODIFY_UNIT (id=Mauhl-Mergren) canrecruit no}
			    [unit]
				type=Death Knight
				id=Mal-Akaalan
				name= _ "Mal-Akaalan"
				unrenamable=yes
				side=5
				x=47
				y=16
				random_traits=no
				canrecruit=yes
			    [/unit]

			{GENERIC_UNIT 5 (Soulless) 47 15}
			{GENERIC_UNIT 5 (Ghost) 48 15}
			{GENERIC_UNIT 5 (Skeleton) 48 16}
			{GENERIC_UNIT 5 (Ghost) 47 17}
			{GENERIC_UNIT 5 (Soulless) 46 16}
			{GENERIC_UNIT 5 (Skeleton Archer) 46 15}

			[message]
				speaker=Mauhl-Mergren
				message = _ "I love this bit. Watching mortals trapped, squirming, begging for mercy."
			[/message]
			{ENEMY_GOLD 5}
			[allow_recruit]
				side=5
				type=Ghost,Revenant,Bone Shooter
			[/allow_recruit]
		[/case]
	[/switch]
[/event]

# Start ramping up enemies in last few turns - most of them shouldn't reach the village in time, but I want the effect of 1) Making it impossible to defeat the enemies, and 2) making it look like a defeat is imminent.

[event]
	name=turn 27
	[gold]
		side=4
		amount=10
	[/gold]
[/event]
[event]
	name=turn 28
	[gold]
		side=4
		amount=20
	[/gold]
	[gold]
		side=3,5
		amount=10
	[/gold]
[/event]
[event]
	name=turn 29
	[gold]
		side=4
		amount=40
	[/gold]
	[gold]
		side=3,5
		amount=20
	[/gold]
[/event]
[event]
	name=turn 30
	[gold]
		side=4
		amount=80
	[/gold]
	[gold]
		side=3,5
		amount=40
	[/gold]
[/event]

# Victory when turns run out.

[event]
	name=time over

#Extremely unlikely you'd survive this long without defeating side 2, but in the unlikely event this happens ...

	[if]
		[have_unit]
		id=Jaan Gragath
		[/have_unit]
		[then]
			[message]
				speaker=Jaan Gragath
				message= _ "Ha ha! You still haven't secured the town, and you're outflanked in all directions. I'll kill you all myself!"
			[/message]
			[endlevel]
				result=defeat
			[/endlevel]
		[/then]
		[else]
			[music]
				name=interlude.ogg
				immediate=yes
			[/music]
			[message]
			    speaker=narrator
			    image="story/book.png"
			    message= _ "The sun reached noon on the second day, and I allowed myself a brief moment of pride. Zharagorn's Darkguard had thrown their forces again and again, and my valiant men had held them back every time. I prayed they would not be able to sustain the assault for a second night, but my hopes were in vain. The enemy lines were growing stronger than ever before. This time, I knew there would be no holding them back."
			[/message]
			[message]
				speaker=Grand General Saathan
				message = _ "You know you cannot beat us. Surrender now, and your deaths will be merciful and swift. Fight on, and your deaths will be one long scream."
			[/message]
			[message]
			    speaker=narrator
			    image="story/book.png"
			    message= _ "As Prince Sven and I prepared for a last stand, I thought to myself that maybe it wasn't a bad way to go. We'd fought Zharagorn's men bravely, weakened his forces, and perhaps someone else would be inspired to carry on the fight. Deuterus would be proud of us fighting to the end."
			[/message]
			[music]
				name=null.ogg
				immediate=yes
			[/music]
			[message]
			    speaker=narrator
			    image="story/book.png"
			    message= _ "But the end never came. I would never in a million years have guessed the thing that was to follow."
			[/message]
			[music]
				name=drums-ominous.ogg
				immediate=yes
			[/music]
			    [unit]
				type=Death Squire
				id=Envoy of Death
				name= _ "Envoy of Death"
				unrenamable=yes
				side=2
				x=22
				y=36
				random_traits=no
				canrecruit=no
			    [/unit]
			{MOVE_UNIT (id=Envoy of Death) 23 35}
			[message]
				speaker=Envoy of Death
				message = _ "All hail the mighty Zharagorn and the invincible Mal-Margheera! I bring a message from our supreme leader."
			[/message]
			[message]
				speaker=Viktor
				message = _ "Is there going to be a point to this mesage, or is it just gloating?"
			[/message]
			[message]
				speaker=Envoy of Death
				message = _ "Silence! The message is not for you. You will keep out of this, worms."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "(Um Viktor, I'm confused. Who could the message be for if it's not us?)"
			[/message]
			[message]
				speaker=Envoy of Death
				message = _ "The Unstoppable Legion of Zharagorn is to commence its final conquest, the city of Karasov. All units are to stand down and join Zharagorn immediately."
			[/message]
			[message]
				speaker=Grand General Saathan
				message = _ "With pleasure! Give me a few more hours crush these rebels and we'll be on our way."
			[/message]
			[message]
				speaker=Envoy of Death
				message = _ "Did I not make myself clear? All units are to stand down immediately. Not in a few hours' time."
			[/message]
			[message]
				speaker=Grand General Saathan
				message = _ "I am Grand General Saathan of the Darkguard! How dare you tell me what to do! I am commanded by Zharagorn himself to slay the vermin who destroyed the Black Emerald!"
			[/message]
			[switch]
				variable=allies
				[case]
				value=orcs
				[message]
					speaker=Grand General Saathan
					message = _ "Have you not slain the orcs responsible?"
				[/message]
				[/case]
				[case]
				value=elves
				[message]
					speaker=Grand General Saathan
					message = _ "Have you not slain the elves responsible?"
				[/message]
				[/case]
			[/switch]
			[message]
				speaker=Grand General Saathan
				message = _ "Yes, but-"
			[/message]
			[message]
				speaker=Envoy of Death
				message = _ "Then you have no further business here."
			[/message]
			[message]
				speaker=Grand General Saathan
				message = _ "Listen you imbecile, it wasn't just the-"
			[/message]
			[message]
				speaker=Envoy of Death
				message = _ "Enough! An order from me is an order from Zharagorn. You are to stand down and proceed to Karasov. Must I remind you what happens to those who defy him?"
			[/message]
			[message]
				speaker=Viktor
				message = _ "I don't believe it. They're actually withdrawing."
			[/message]
			[music]
				name=null.ogg
				immediate=yes
			[/music]
			[message]
				speaker=Grand General Saathan
				message = _ "You don't know how lucky you are. This is not over. Once Karasov has fallen, I swear I will find you and kill you all."
			[/message]
			[kill]
				side=2,3,4,5
			[/kill]
			[message]
			    speaker=narrator
			    image="story/book.png"
			    message= _ "And then they were gone. We watched in disbelief as they vanished over the horizon. Had Zharagorn's envoy really not realised the threat we posed? Or did he simply not consider us a threat worth fighting? We regrouped in Thorben to plan our next move."
			[/message]

			{MOVE_UNIT (id=Viktor) 24 18}
			{MOVE_UNIT (id=Prince Sven) 21 18}

			{TELEPORT_UNIT (id=Hubert) 28 18}
			{TELEPORT_UNIT (id=Golran) 28 16}
			{TELEPORT_UNIT (id=Halgar the Mighty) 20 17}
			{TELEPORT_UNIT (id=Captain Josephine) 20 17}
			{TELEPORT_UNIT (side=1
			    [filter_wml]
				[modifications]
				    [object]
					id=holywater
				    [/object]
				[/modifications]
			    [/filter_wml]) 20 17}
			{TELEPORT_UNIT (id=Mur'ag-Argrath) 27 20}
			{TELEPORT_UNIT (id=Aethaer-Faragan) 27 20}
			[redraw]
			[/redraw]
			[music]
				name=revelation.ogg
				immediate=yes
			[/music]
			[message]
				speaker=Golran
				message = _ "Phew! That was close. I really thought we were done for this time."
			[/message]
			[message]
				speaker=Viktor
				message = _ "So it seems Eridith was right. Zharagorn is arrogant, and complacent too."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "I wouldn't take too much heart from this. If that really was the order to converge on Karasov, we don't have much time left."
			[/message]
			[if]
				[have_unit]
				id=Village idiot
				[/have_unit]
				[then]
					{MOVE_UNIT (id=Village idiot) 25 17}
					{MODIFY_UNIT (id=Village idiot) facing se}
					[message]
						speaker=Village idiot
						message= _ "Hah! We showed them, didn't we?"
					[/message]
				[/then]
				[else]
					[unit]
						type=Peasant
						id=Village idiot
						name= _ "Village idiot"
						x=24
						y=18
						side=6
					[/unit]
					{MOVE_UNIT (id=Village idiot) 25 17}
					{MODIFY_UNIT (id=Village idiot) facing se}
					[message]
						speaker=Village idiot
						message= _ "Hah! We showed them, didn't we?"
					[/message]
					[message]
						speaker=Prince Sven
						message= _ "(Oh no, not him again!)"
					[/message]
				[/else]
			[/if]		
			[message]
				speaker=Viktor
				message = _ "Any sign of Deuterus's body?"
			[/message]
			[message]
				speaker=Hubert
				message = _ "Sorry Viktor, we searched the whole town. No sign of his body anywhere."
			[/message]
			[message]
				speaker=Village idiot
				message= _ "I told you! He was burned! All burned!"
			[/message]
			[message]
				speaker=Viktor
				message = _ "Okay, that's the least of the problems. We've got to think about how we save Karasov. I was hoping we might be able to search for some sort of weakness, but there's no time for that now."
			[/message]
			[message]
				speaker=Golran
				message = _ "You're not going to suggest fighting them head-on, are you?"
			[/message]
			[message]
			    side=1
			    [filter_wml]
				[modifications]
				    [object]
					id=holywater
				    [/object]
				[/modifications]
			    [/filter_wml]
				message= _ "Perhaps we could follow Zharagorn's forces and launch raids on their supply lines."
			[/message]
			[message]
				speaker=Halgar the Mighty
				message = _ "Maybe we could ambush Zharagorn's forces from the tunnels under Karasov."
			[/message]
			[message]
				speaker=Captain Josephine
				message = _ "We could go head to the southern kingdoms and try to gather reinforcements."
			[/message]
			[message]
				speaker=Village idiot
				message= _ "What are you going to do, boy? Fight like a man, or flee like a coward?"
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "(Okay, that fool's really getting on my nerves now.)"
			[/message]
			[message]
				speaker=Viktor
				message = _ "All right, I think I know what we should do. We should first of all head to Burinsbay, try and get hold of some ships."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "Are you saying we should flee the land completely?"
			[/message]
			[message]
				speaker=Village idiot
				message= _ "What are you, boy? A man or a mouse?"
			[/message]
			[message]
				speaker=Viktor
				message = _ "No. I say we take some ships, sail into Karasov, and reinforce the lines."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "Are you insane? You want us to do this again?"
			[/message]
			[message]
				speaker=Viktor
				message = _ "Why is Zharagorn so desperate to get every last man into the lines for the siege of Karasov?"
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "I don't know. But what's that got to do with anything?"
			[/message]
			[message]
				speaker=Viktor
				message = _ "Why would he want to do this if he's legion's meant to be unbeatable? I wonder ... Maybe he's not a strong as he'd have us believe. Maybe, just maybe, we can turn the tide if we join the battle."
			[/message]
			[message]
				speaker=Village idiot
				message= _ "That's more like it, boy! Show them what you're made of!"
			[/message]
			[message]
				speaker=Mur'ag-Argrath
				message = _ "Viktor, is there any way you can get that peasant to shut up for a moment?"
			[/message]
			[message]
				speaker=Aethaer-Faragan
				message = _ "Viktor, don't mean to be rude, could you tell that peasant to shut up?"
			[/message]
			[message]
				speaker=Viktor
				message = _ "Wait a minute, I recognise that voice ... That's no peasant."
			[/message]
			[music]
				name=null.ogg
				immediate=yes
			[/music]
			[message]
				speaker=Village idiot
				message= _ "Peasant? I ain't no stinking peasant! I'll tell you who I am! I am ..."
			[/message]
			[kill]
				id=Village idiot
			[/kill]
			[sound]
			name=lightning.ogg
			[/sound]
	
			[color_adjust]
			red=100
			green=100
			blue=100
			[/color_adjust]
	
			[delay]
			time=10
			[/delay]
	
			[color_adjust]
			red=0
			green=0
			blue=0
			[/color_adjust]

			[unstore_unit]
				variable=deuterus
				x=25
				y=17
				find_vacant=yes
			[/unstore_unit]				

#Due to an earlier bug, it is possible a player might reach thsi screen without a deuterus variable to unstore (if played through scenario 13 before the fix). This is a workaround that sort-of caters for this scenario - it can be deleted when ported to the next version.
			[if]
				[not]
					[have_unit]
					id=Deuterus
					[/have_unit]
				[/not]
				[then]
					[unit]
						side=1
						type=Great Druid
						id=Deuterus
						name= _ "Deuterus"
						{IS_HERO}
						profile="portraits/deuterus.png"
						[modifications]
							{TRAIT_LOYAL}
							{TRAIT_INTELLIGENT}
						[/modifications]
						x,y=25,17
					[/unit]
				[/then]
			[/if]		
			{MODIFY_UNIT (id=Deuterus) facing se}
			[music]
				name=legends_of_the_north.ogg
				immediate=yes
			[/music]
			[message]
				id=Deuterus
				message= _ "... Deuterus, Great Druid of the northern forest, and I'm back."
			[/message]
			[message]
				speaker=Viktor
				message = _ "Deuterus?"
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "We thought you were dead."
			[/message]
			[message]
				id=Deuterus
				message= _ "Yes ... that was the idea."
			[/message]
			[message]
				speaker=Viktor
				message = _ "But that's impossible - I saw you die!"
			[/message]
			[message]
				id=Deuterus
				message= _ "I know. I needed you to believe I was dead. It was the only way."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "I'm still not following this."
			[/message]
			[message]
				speaker=Viktor
				message = _ "Okay, you can explain that later. Right now, we've got a problem. We've destroyed the Black Emerald and ..."
			[/message]
			[message]
				id=Deuterus
				message= _ "... I know. The Legion of Zharagorn marches on. I thought that might happen."
			[/message]
			[message]
				speaker=Prince Sven
				message = _ "WHAT???? You mean you knew all along that destroying the stone wouldn't work?"
			[/message]
			[message]
				id=Deuterus
				message= _ "Oh, it had to be destroyed. It's just that this is only the first step to defeating Zharagorn."
			[/message]
			[message]
				speaker=Viktor
				message = _ "Okay then, how many more steps are there?"
			[/message]
			[message]
				id=Deuterus
				message= _ "Only one more. We'll do as you suggested: make our way to Burinsbay. Take the boats to Karasov. Then we fight."
			[/message]
			[message]
				speaker=Viktor
				message = _ "But ... but what about-"
			[/message]
			[message]
				id=Deuterus
				message= _ "Do not doubt yourself, Viktor. It is time for a final showdown with Zharagorn. And the only person who can lead Suveran to victory is you."
			[/message]
			[message]
			    speaker=narrator
			    image="story/book.png"
			    message= _ "This was my story. I had hoped that one day I would chronicle the defeat of Zharagorn. But that privilege is mine no longer. It is time to hand this journal back to its rightful owner - and I have faith that it shall be Dueterus who pen the story of our victory."
			[/message]
			[endlevel]
				result=victory
				bonus=no
           			{NEW_GOLD_CARRYOVER 40}
				carryover_report=yes
			[/endlevel]

		[/else]
	[/if]	

[/event]

# Defeat

	{~add-ons/The_Unstoppable_Legion/utils/deaths.cfg}

[/scenario]

